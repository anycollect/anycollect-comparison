extensions:
- !load
  extension: MeterRegistry
  instance: registry
- !load
  extension: PullEngine
  instance: puller
  dependencies:
    registry: !ref registry
  config:
    updatePeriod: 1000 # expired timeout
    pullPeriod: 10
    defaultPoolSize: 1
    healthChecks:
      period: 20
      timeout: 5
      checks: []
- !load
  extension: SelfDiscovery
  instance: self
- !load
  extension: MeterRegistryReader
  instance: selfReader
  dependencies:
    puller: !ref puller
    registry: !ref registry
    self: !ref self
- !load
  extension: DummyDeserializer
  instance: dummy
- !load
  extension: NettyAsyncSocketReader
  instance: blackhole
  dependencies:
    deserializer: !ref dummy
  config:
    port: !var BLACKHOLE_PORT
- !load
  extension: CountingProcessor
  instance: counting
  config:
    rules:
    - filter: "cassandra.*"
      group: anycollect
      period: 5
    - filter: "stub.*"
      group: anycollect
      period: 10
    - filter: "servers.*"
      group: jmxtrans
      period: 10
    - filter: "fastjmx.*"
      group: fastjmx
      period: 10
# -- Slf4j ---
- !load
  extension: Slf4jWriter
  instance: slf4j
# --- GRAPHITE ---
- !load
  extension: TagGraphiteSerializer
  instance: graphiteSerializer
- !load
  extension: SocketWriter
  instance: graphite
  dependencies:
    format: !ref graphiteSerializer
  config:
    host: !var GRAPHITE_HOST
    port: !var GRAPHITE_PORT
    protocol: TCP
# --- ROUTER --
- !load
  extension: Router
  instance: router
  dependencies:
    readers: !refs
    - selfReader
    - blackhole
    processors: !refs
    - counting
    writers: !refs
    - graphite
    - slf4j
  config:
    topology:
    - from: blackhole
      to: counting
    - from: counting
      to: slf4j
    - from: counting
      to: graphite
